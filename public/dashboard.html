<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Paw Whisker</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-paw" style="color:var(--primary-color)"></i> Paw <span>Whisker</span>
        </div>

        <ul class="menu">
            <li><a href="#" class="active"><i class="fa-solid fa-grid-2"></i> Dashboard</a></li>

            <!-- Appointments: All Roles -->
            <li class="role-admin role-resepsionis role-dokter"><a href="#"><i class="fa-solid fa-calendar-check"></i>
                    Appointments</a></li>

            <!-- Patients: Admin & Recep -->
            <li class="role-admin role-resepsionis"><a href="#"><i class="fa-solid fa-users"></i> Patients & Owners</a>
            </li>

            <!-- Records: Admin & Doctor -->
            <li class="role-admin role-dokter"><a href="#"><i class="fa-solid fa-stethoscope"></i> Medical Records</a>
            </li>

            <!-- Staff: Admin Only -->
            <li class="role-admin"><a href="#"><i class="fa-solid fa-user-doctor"></i> Staff Management</a></li>
            <li class="role-admin"><a href="#"><i class="fa-solid fa-boxes-stacked"></i> Inventory</a></li>

            <!-- Transactions: Admin & Recep -->
            <li class="role-admin role-resepsionis"><a href="#"><i class="fa-solid fa-cash-register"></i>
                    Transactions</a></li>

            <li><a href="#" id="nav-settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
        </ul>

        <div class="user-profile">
            <div class="avatar">
                <i class="fa-solid fa-user"></i>
            </div>
            <div class="user-info">
                <h4 id="user-name">Loading...</h4>
                <p id="user-role">...</p>
                <a href="/auth/logout" class="logout-btn">Logout</a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div>
                <h2>Overview</h2>
                <p class="date-display" id="current-date">Fetching date...</p>
            </div>
        </header>

        <!-- DASHBOARD SECTION -->
        <div id="dashboard-view" class="section-content">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-purple">
                        <i class="fa-solid fa-cat"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-patients">0</h3>
                        <p>Total Patients</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-pink">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="revenue-today">Rp 0</h3>
                        <p>Revenue Today</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-blue">
                        <i class="fa-solid fa-user-nurse"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="active-staff">0</h3>
                        <p>Active Staff</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-orange">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="low-stock">0</h3>
                        <p>Low Stock Items</p>
                    </div>
                </div>
            </div>

            <!-- Operational Section -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div class="left-col">
                    <!-- Live Queue -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Live Queue</h3>
                            <span class="status-badge status-diperiksa">Live</span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Pet Name</th>
                                    <th>Doctor/Groomer</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="queue-body">
                                <tr>
                                    <td colspan="4" style="text-align:center; color:#94a3b8">No appointments today</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Sales Chart -->
                    <div class="card role-admin role-resepsionis">
                        <div class="card-header">
                            <h3>Revenue (Last 7 Days)</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="right-col">
                    <!-- Recent Medical Records -->
                    <div class="card role-admin role-dokter" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Recent Records</h3>
                        </div>
                        <div class="record-list" id="recent-records">
                            <p style="text-align:center; color:#94a3b8">Loading...</p>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="card role-admin role-resepsionis" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Payment Methods</h3>
                        </div>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>

                    <!-- Best Services -->
                    <div class="card role-admin role-resepsionis">
                        <div class="card-header">
                            <h3>Top Services</h3>
                        </div>
                        <div class="record-list" id="best-services">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW SECTIONS (Initially Hidden) -->

        <!-- Appointments View (New) -->
        <div id="appointments-view" class="section-content app-section" style="display:none;">
            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header">
                        <h3>Book New Appointment</h3>
                    </div>
                    <form id="appointmentForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Owner</label>
                            <select id="apt-owner" required class="status-select" style="width:100%; padding:0.8rem;">
                                <option value="">Select Owner</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Pet</label>
                            <select id="apt-pet" required class="status-select" style="width:100%; padding:0.8rem;"
                                disabled>
                                <option value="">Select Owner First</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Doctor /
                                Groomer</label>
                            <select id="apt-doctor" required class="status-select" style="width:100%; padding:0.8rem;">
                                <option value="">Loading doctors...</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Date &
                                Time</label>
                            <input type="datetime-local" id="apt-date" required
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group" style="grid-column: span 2;">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Initial
                                Complaint / Notes</label>
                            <textarea id="apt-complaint" rows="3"
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                        </div>

                        <div style="grid-column: span 2; text-align:right;">
                            <button type="submit" class="cta-button">Create Appointment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Patients View -->
        <div id="patients-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Patients & Owners</h3>
                    <button class="cta-button" style="font-size:0.8rem; padding:0.5rem 1rem;">+ Add New</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Owner Name</th>
                            <th>Phone</th>
                            <th>Pets</th>
                            <th>Address</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Staff View -->
        <div id="staff-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Staff Management</h3>
                    <button class="cta-button" onclick="openModal('staffModal')">
                        <i class="fa-solid fa-plus"></i> Add Staff
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Username</th>
                                <th>Specialization</th>
                                <th>Contact</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                    <div id="staff-empty-state" style="display:none; text-align:center; padding:2rem; color:#94a3b8;">
                        <i class="fa-solid fa-user-doctor" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
                        <p>No staff members found.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory View -->
        <div id="inventory-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Inventory Management</h3>
                    <button class="cta-button" onclick="openModal('inventoryModal')">
                        <i class="fa-solid fa-plus"></i> Add Item
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                    <div id="inventory-empty-state"
                        style="display:none; text-align:center; padding:2rem; color:#94a3b8;">
                        <i class="fa-solid fa-box-open" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
                        <p>Inventory is empty.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions View -->
        <div id="transactions-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Recent Transactions</h3>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Owner</th>
                            <th>Method</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="section-content app-section" style="display:none;">
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div class="card-header">
                    <h3>Account Settings</h3>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Change Password</h4>
                    <p style="margin-bottom: 1rem; color: #94a3b8; font-size: 0.9rem;">To secure your account, regular
                        password updates are recommended.</p>
                    <button id="openChangePassModalBtn" class="cta-button" style="width: 100%;">Change Password</button>
                </div>

                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #ef4444;">Danger Zone</h4>
                    <p style="margin-bottom: 1rem; color: #94a3b8;">To delete your account, type <strong>delete my
                            account <span id="confirm-username-display"></span></strong> below:</p>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="deleteConfirmationInput" placeholder="Type the confirmation phrase"
                            style="width:100%; padding: 0.8rem; border:1px solid #ef4444; border-radius:8px; background: rgba(239, 68, 68, 0.05); color: #ef4444; margin-bottom: 0.5rem;">
                        <small style="color: #94a3b8; display: block;">Make sure the text matches exactly to enable the
                            button.</small>
                    </div>
                    <button id="deleteAccountBtn" disabled
                        style="background: #ef4444; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 600; opacity: 0.5; cursor: not-allowed;">Delete
                        Account</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Add Staff Modal -->
    <div id="staffModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Staff Member</h3>
                <button class="close-modal" onclick="closeModal('staffModal')">&times;</button>
            </div>
            <form id="addStaffForm" onsubmit="submitAddStaff(event)">
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" name="nama_lengkap" required>
                </div>
                <div class="input-group">
                    <label>Position / Role</label>
                    <select name="jabatan" required onchange="toggleSpesialisasi(this.value)">
                        <option value="Dokter Hewan">Dokter Hewan</option>
                        <option value="Groomer">Groomer</option>
                        <option value="Staff">Staff (Admin/Receptionist)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>System Role (Login Access)</label>
                    <select name="role" required>
                        <option value="Dokter">Dokter</option>
                        <option value="Resepsionis">Resepsionis</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                <div class="input-group" id="spesialisasi-group">
                    <label>Specialization</label>
                    <input type="text" name="spesialisasi" placeholder="e.g. Surgery, Dermatology">
                </div>
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="text" name="no_hp" required>
                </div>
                <!-- Account Details -->
                <div style="margin-top:1rem; border-top:1px solid var(--glass-border); padding-top:1rem;">
                    <h4 style="margin-bottom:1rem; color:var(--text-color)">Login Credentials</h4>
                    <div class="input-group">
                        <label>Username</label>
                        <input type="text" name="username" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" name="password" required>
                    </div>
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Create Staff
                    Account</button>
            </form>
        </div>
    </div>

    <!-- Add Inventory Modal -->
    <div id="inventoryModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Inventory Item</h3>
                <button class="close-modal" onclick="closeModal('inventoryModal')">&times;</button>
            </div>
            <form id="addInventoryForm" onsubmit="submitAddItem(event)">
                <div class="input-group">
                    <label>Item Name</label>
                    <input type="text" name="nama_barang" required>
                </div>
                <div class="input-group">
                    <label>Category</label>
                    <select name="kategori" required>
                        <option value="Obat">Obat</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Aksesoris">Aksesoris</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Stock Quantity</label>
                    <input type="number" name="stok" min="0" required>
                </div>
                <div class="input-group">
                    <label>Unit Price (IDR)</label>
                    <input type="number" name="harga_satuan" min="0" required>
                </div>
                <div class="input-group">
                    <label>Unit Type</label>
                    <input type="text" name="satuan" placeholder="e.g. Pcs, Botol, Kg" required>
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="passwordModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button id="closePasswordModal" class="close-modal">&times;</button>
            </div>
            <form id="changePasswordForm">
                <div style="margin-bottom: 1rem;">
                    <label style="display:block; margin-bottom:0.5rem; color:var(--text-muted)">Old Password</label>
                    <input type="password" id="oldPassword" required
                        style="width:100%; padding: 0.8rem; border:1px solid var(--glass-border); border-radius:8px; background: rgba(255, 255, 255, 0.05); color: white;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display:block; margin-bottom:0.5rem; color:var(--text-muted)">New Password</label>
                    <input type="password" id="newPassword" required
                        style="width:100%; padding: 0.8rem; border:1px solid var(--glass-border); border-radius:8px; background: rgba(255, 255, 255, 0.05); color: white;">
                </div>
                <button type="submit" class="cta-button" style="width:100%">Update Password</button>
            </form>
        </div>
    </div>

    <script src="js/dashboard.js"></script>
</body>

</html>