<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Paw Whisker</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-paw" style="color:var(--primary-color)"></i> Paw <span>Whisker</span>
        </div>

        <ul class="menu">
            <li><a href="#" class="active"><i class="fa-solid fa-grid-2"></i> Dashboard</a></li>

            <!-- Appointments: All Roles -->
            <li class="role-admin role-resepsionis role-dokter"><a href="#"><i class="fa-solid fa-calendar-check"></i>
                    Appointments</a></li>

            <!-- Patients: Admin & Recep -->
            <li class="role-admin role-resepsionis"><a href="#"><i class="fa-solid fa-users"></i> Patients & Owners</a>
            </li>

            <!-- Records: Admin & Doctor -->
            <li class="role-admin role-dokter"><a href="#"><i class="fa-solid fa-stethoscope"></i> Medical Records</a>
            </li>

            <!-- Staff: Admin Only -->
            <li class="role-admin"><a href="#"><i class="fa-solid fa-user-doctor"></i> Staff Management</a></li>

            <!-- Inventory: Admin & Resepsionis -->
            <li class="role-admin role-resepsionis"><a href="#"><i class="fa-solid fa-boxes-stacked"></i> Inventory</a>
            </li>

            <!-- Transactions: Admin & Recep -->
            <li class="role-admin role-resepsionis"><a href="#"><i class="fa-solid fa-cash-register"></i>
                    Transactions</a></li>

            <li><a href="#" id="nav-settings"><i class="fa-solid fa-gear"></i> Settings</a></li>
        </ul>

        <div class="user-profile">
            <div class="avatar">
                <i class="fa-solid fa-user"></i>
            </div>
            <div class="user-info">
                <h4 id="user-name">Loading...</h4>
                <p id="user-role">...</p>
                <a href="/auth/logout" class="logout-btn">Logout</a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div>
                <h2>Overview</h2>
                <p class="date-display" id="current-date">Fetching date...</p>
            </div>
        </header>

        <!-- DASHBOARD SECTION -->
        <div id="dashboard-view" class="section-content">
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon icon-purple">
                        <i class="fa-solid fa-cat"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-patients">0</h3>
                        <p>Total Patients</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-pink">
                        <i class="fa-solid fa-wallet"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="revenue-today">Rp 0</h3>
                        <p>Revenue Today</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon icon-blue">
                        <i class="fa-solid fa-user-nurse"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="active-staff">0</h3>
                        <p>Active Staff</p>
                    </div>
                </div>

                <div class="stat-card" onclick="navigateToInventory()" style="cursor:pointer;"
                    title="Click to view inventory">
                    <div class="stat-icon icon-orange">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="low-stock">0</h3>
                        <p>Low Stock Items</p>
                    </div>
                </div>
            </div>

            <!-- Operational Section -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div class="left-col">
                    <!-- Live Queue -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Live Queue</h3>
                            <span class="status-badge status-diperiksa">Live</span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Pet Name</th>
                                    <th>Doctor/Groomer</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="queue-body">
                                <tr>
                                    <td colspan="4" style="text-align:center; color:#94a3b8">No appointments today</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Sales Chart -->
                    <div class="card role-admin role-resepsionis">
                        <div class="card-header">
                            <h3>Revenue (Last 7 Days)</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="right-col">
                    <!-- Recent Medical Records -->
                    <div class="card role-admin role-dokter" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Recent Records</h3>
                        </div>
                        <div class="record-list" id="recent-records">
                            <p style="text-align:center; color:#94a3b8">Loading...</p>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="card role-admin role-resepsionis" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3>Payment Methods</h3>
                        </div>
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>

                    <!-- Best Services -->
                    <div class="card role-admin role-resepsionis">
                        <div class="card-header">
                            <h3>Top Services</h3>
                        </div>
                        <div class="record-list" id="best-services">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW SECTIONS (Initially Hidden) -->

        <!-- Appointments View (New) -->
        <div id="appointments-view" class="section-content app-section" style="display:none;">
            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header">
                        <h3>Book New Appointment</h3>
                    </div>
                    <form id="appointmentForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Owner</label>
                            <select id="apt-owner" required class="status-select" style="width:100%; padding:0.8rem;">
                                <option value="">Select Owner</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Pet</label>
                            <select id="apt-pet" required class="status-select" style="width:100%; padding:0.8rem;"
                                disabled>
                                <option value="">Select Owner First</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Service</label>
                            <select id="apt-service" required class="status-select" style="width:100%; padding:0.8rem;">
                                <option value="">Select Service</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Doctor /
                                Groomer</label>
                            <select id="apt-doctor" required class="status-select" style="width:100%; padding:0.8rem;">
                                <option value="">Loading doctors...</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Date &
                                Time</label>
                            <input type="datetime-local" id="apt-date" required
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group" style="grid-column: span 2;">
                            <label style="color:var(--text-muted); display:block; margin-bottom:0.5rem">Initial
                                Complaint / Notes</label>
                            <textarea id="apt-complaint" rows="3"
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                        </div>

                        <div style="grid-column: span 2; text-align:right;">
                            <button type="submit" class="cta-button">Create Appointment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Patients View -->
        <div id="patients-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Patients & Owners</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <button class="cta-button" onclick="openModal('ownerModal')"
                            style="font-size:0.8rem; padding:0.5rem 1rem;">
                            <i class="fa-solid fa-user-plus"></i> Add Owner
                        </button>
                        <button class="cta-button" onclick="openModal('petModal')"
                            style="font-size:0.8rem; padding:0.5rem 1rem; background:var(--secondary-color);">
                            <i class="fa-solid fa-paw"></i> Add Pet
                        </button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Owner Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Pets</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="owners-table-body">
                        <tr>
                            <td colspan="5" style="text-align:center; color:#94a3b8; padding:2rem;">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Staff View -->
        <div id="staff-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Staff Management</h3>
                    <button class="cta-button" onclick="openModal('staffModal')">
                        <i class="fa-solid fa-plus"></i> Add Staff
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Username</th>
                                <th>Specialization</th>
                                <th>Contact</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                    <div id="staff-empty-state" style="display:none; text-align:center; padding:2rem; color:#94a3b8;">
                        <i class="fa-solid fa-user-doctor" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
                        <p>No staff members found.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory View -->
        <div id="inventory-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Inventory Management</h3>
                    <button class="cta-button" onclick="openModal('inventoryModal')">
                        <i class="fa-solid fa-plus"></i> Add Item
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Stock</th>
                                <th>Price</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                    <div id="inventory-empty-state"
                        style="display:none; text-align:center; padding:2rem; color:#94a3b8;">
                        <i class="fa-solid fa-box-open" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
                        <p>Inventory is empty.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Medical Workspace View (Doctor Only) -->
        <div id="medical-workspace-view" class="section-content app-section role-dokter" style="display:none;">
            <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr; gap:1.5rem;">
                <!-- Left: Live Queue + Medical Record Form -->
                <div>
                    <div class="card" style="margin-bottom:1.5rem;">
                        <div class="card-header">
                            <h3>My Queue Today</h3>
                            <span class="status-badge status-diperiksa">Live</span>
                        </div>
                        <div id="doctor-queue-list" style="max-height:500px; overflow-y:auto;">
                            <p style="text-align:center; color:#94a3b8; padding:2rem;">Loading...</p>
                        </div>
                    </div>
                </div>

                <!-- Right: Patient History -->
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Patient History</h3>
                            <input type="text" id="patient-search" placeholder="Search patient..."
                                onkeyup="searchPatientHistory()"
                                style="padding:0.5rem 1rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px; width:200px;">
                        </div>
                        <div id="patient-history-list" style="max-height:600px; overflow-y:auto;">
                            <p style="text-align:center; color:#94a3b8; padding:2rem;">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions View -->
        <div id="transactions-view" class="section-content app-section" style="display:none;">
            <div class="card">
                <div class="card-header">
                    <h3>Recent Transactions</h3>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Owner</th>
                            <th>Method</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="section-content app-section" style="display:none;">
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <div class="card-header">
                    <h3>Account Settings</h3>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Change Password</h4>
                    <p style="margin-bottom: 1rem; color: #94a3b8; font-size: 0.9rem;">To secure your account, regular
                        password updates are recommended.</p>
                    <button id="openChangePassModalBtn" class="cta-button" style="width: 100%;">Change Password</button>
                </div>

                <!-- Doctor/Staff Profile Section -->
                <div id="doctor-profile-section"
                    style="display:none; margin-bottom:2rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color:var(--primary-color);">My Profile</h4>
                    <form onsubmit="updateDoctorProfile(event)">
                        <div class="input-group">
                            <label>Full Name *</label>
                            <input type="text" id="profile-name" required
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group">
                            <label>Specialization</label>
                            <input type="text" id="profile-spec" placeholder="e.g. Surgery, Dermatology"
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="profile-phone" pattern="[0-9]{10,15}"
                                title="Phone number must be 10-15 digits (numeric only)" placeholder="08123456789"
                                required
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group">
                            <label>Email</label>
                            <input type="email" id="profile-email" placeholder="your.email@example.com"
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                        </div>

                        <div class="input-group">
                            <label>Address</label>
                            <textarea id="profile-address" rows="3" placeholder="Your address"
                                style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px; resize:vertical;"></textarea>
                        </div>

                        <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">
                            <i class="fa-solid fa-save"></i> Update Profile
                        </button>
                    </form>
                </div>

                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #ef4444;">Danger Zone</h4>
                    <p style="margin-bottom: 1rem; color: #94a3b8;">To delete your account, type <strong>delete my
                            account <span id="confirm-username-display"></span></strong> below:</p>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" id="deleteConfirmationInput" placeholder="Type the confirmation phrase"
                            style="width:100%; padding: 0.8rem; border:1px solid #ef4444; border-radius:8px; background: rgba(239, 68, 68, 0.05); color: #ef4444; margin-bottom: 0.5rem;">
                        <small style="color: #94a3b8; display: block;">Make sure the text matches exactly to enable the
                            button.</small>
                    </div>
                    <button id="deleteAccountBtn" disabled
                        style="background: #ef4444; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: 600; opacity: 0.5; cursor: not-allowed;">Delete
                        Account</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Add Staff Modal -->
    <div id="staffModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Staff Member</h3>
                <button class="close-modal" onclick="closeModal('staffModal')">&times;</button>
            </div>
            <form id="addStaffForm" onsubmit="submitAddStaff(event)">
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" name="nama_lengkap" required>
                </div>
                <div class="input-group">
                    <label>Position / Role</label>
                    <select name="jabatan" required onchange="toggleSpesialisasi(this.value)">
                        <option value="Dokter Hewan">Dokter Hewan</option>
                        <option value="Groomer">Groomer</option>
                        <option value="Staff">Staff (Admin/Receptionist)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>System Role (Login Access)</label>
                    <select name="role" required>
                        <option value="Dokter">Dokter</option>
                        <option value="Resepsionis">Resepsionis</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                <div class="input-group" id="spesialisasi-group">
                    <label>Specialization</label>
                    <input type="text" name="spesialisasi" placeholder="e.g. Surgery, Dermatology">
                </div>
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="tel" name="no_hp" pattern="[0-9]{10,15}"
                        title="Phone number must be 10-15 digits (numeric only)" placeholder="08123456789" required>
                </div>
                <!-- Account Details -->
                <div style="margin-top:1rem; border-top:1px solid var(--glass-border); padding-top:1rem;">
                    <h4 style="margin-bottom:1rem; color:var(--text-color)">Login Credentials</h4>
                    <div class="input-group">
                        <label>Username</label>
                        <input type="text" name="username" required>
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <div style="position: relative;">
                            <input type="password" name="password" id="add-staff-password" required
                                style="width: 100%; padding-right: 40px;">
                            <button type="button"
                                onclick="togglePasswordVisibility('add-staff-password', 'toggle-password-icon')"
                                style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-color);">
                                <i class="fa-solid fa-eye" id="toggle-password-icon"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Create Staff
                    Account</button>
            </form>
        </div>
    </div>

    <!-- Edit Staff Modal -->
    <div id="editStaffModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Staff Member</h3>
                <button class="close-modal" onclick="closeModal('editStaffModal')">&times;</button>
            </div>
            <form id="editStaffForm" onsubmit="submitEditStaff(event)">
                <input type="hidden" id="edit-staff-id">

                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" id="edit-staff-name" required>
                </div>

                <div class="form-row" style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                    <div class="input-group">
                        <label>Position / Role</label>
                        <select id="edit-staff-position" required onchange="toggleEditSpesialisasi(this.value)">
                            <option value="Dokter Hewan">Dokter Hewan</option>
                            <option value="Groomer">Groomer</option>
                            <option value="Staff">Staff (Admin/Receptionist)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>System Role (Login)</label>
                        <select id="edit-staff-role" required>
                            <option value="Dokter">Dokter</option>
                            <option value="Resepsionis">Resepsionis</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="edit-staff-username" readonly
                        style="background:#f1f5f9; color:var(--text-color); cursor:not-allowed; border-color:var(--glass-border);">
                </div>

                <div class="input-group" id="edit-spesialisasi-group">
                    <label>Specialization</label>
                    <input type="text" id="edit-staff-spec" placeholder="e.g. Surgery, Dermatology">
                </div>

                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="tel" id="edit-staff-phone" pattern="[0-9]{10,15}"
                        title="Phone number must be 10-15 digits (numeric only)" required>
                </div>

                <div class="modal-actions" style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" class="secondary-btn" onclick="closeModal('editStaffModal')"
                        style="flex:1; justify-content:center;">Cancel</button>
                    <button type="submit" class="cta-button"
                        style="flex:1; background:var(--primary-color); color:white; justify-content:center;">
                        <i class="fa-solid fa-save"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Inventory Modal -->
    <div id="inventoryModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Inventory Item</h3>
                <button class="close-modal" onclick="closeModal('inventoryModal')">&times;</button>
            </div>
            <form id="addInventoryForm" onsubmit="submitAddItem(event)">
                <div class="input-group">
                    <label>Item Name</label>
                    <input type="text" name="nama_barang" required>
                </div>
                <div class="input-group">
                    <label>Category</label>
                    <select name="kategori" required>
                        <option value="Obat">Obat</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Aksesoris">Aksesoris</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Stock Quantity</label>
                    <input type="number" name="stok" min="0" required>
                </div>
                <div class="input-group">
                    <label>Unit Price (IDR)</label>
                    <input type="number" name="harga_satuan" min="0" required>
                </div>
                <div class="input-group">
                    <label>Unit Type</label>
                    <input type="text" name="satuan" placeholder="e.g. Pcs, Botol, Kg" required>
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Edit Inventory Modal -->
    <div id="editInventoryModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Inventory Item</h3>
                <button class="close-modal" onclick="closeModal('editInventoryModal')">&times;</button>
            </div>
            <form id="editInventoryForm" onsubmit="submitEditInventory(event)">
                <input type="hidden" id="edit-inv-id">

                <div class="input-group">
                    <label>Item Name</label>
                    <input type="text" id="edit-inv-name" readonly
                        style="background:#f1f5f9; color:var(--text-color); cursor:not-allowed; border-color:var(--glass-border);">
                </div>

                <div class="form-row" style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                    <div class="input-group">
                        <label>Stock Quantity *</label>
                        <input type="number" id="edit-inv-stock" min="0" required>
                    </div>
                    <div class="input-group">
                        <label>Unit Type *</label>
                        <input type="text" id="edit-inv-unit" required placeholder="e.g. Pcs, Kg, Botol">
                    </div>
                </div>

                <div class="input-group">
                    <label>Unit Price (Rp) *</label>
                    <input type="number" id="edit-inv-price" min="0" step="100" required>
                </div>

                <div class="modal-actions" style="display:flex; gap:1rem; margin-top:1.5rem;">
                    <button type="button" class="secondary-btn" onclick="closeModal('editInventoryModal')"
                        style="flex:1; justify-content:center;">Cancel</button>
                    <button type="submit" class="cta-button"
                        style="flex:1; background:var(--primary-color); color:white; justify-content:center;">
                        <i class="fa-solid fa-save"></i> Update Item
                    </button>
                </div>
            </form>
        </div>
    </div>


    <!-- Change Password Modal -->
    <div id="passwordModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button id="closePasswordModal" class="close-modal">&times;</button>
            </div>
            <form id="changePasswordForm">
                <div style="margin-bottom: 1rem;">
                    <label style="display:block; margin-bottom:0.5rem; color:var(--text-muted)">Old Password</label>
                    <input type="password" id="oldPassword" required
                        style="width:100%; padding: 0.8rem; border:1px solid var(--glass-border); border-radius:8px; background: rgba(255, 255, 255, 0.05); color: white;">
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display:block; margin-bottom:0.5rem; color:var(--text-muted)">New Password</label>
                    <input type="password" id="newPassword" required
                        style="width:100%; padding: 0.8rem; border:1px solid var(--glass-border); border-radius:8px; background: rgba(255, 255, 255, 0.05); color: white;">
                </div>
                <button type="submit" class="cta-button" style="width:100%">Update Password</button>
            </form>
        </div>
    </div>

    <!-- Add Owner Modal -->
    <div id="ownerModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Owner</h3>
                <button class="close-modal" onclick="closeModal('ownerModal')">&times;</button>
            </div>
            <form id="addOwnerForm" onsubmit="submitAddOwner(event)">
                <div class="input-group">
                    <label>Owner Name</label>
                    <input type="text" name="nama_pemilik" required>
                </div>
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="text" name="no_hp" required>
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" name="email">
                </div>
                <div class="input-group">
                    <label>Address</label>
                    <textarea name="alamat" rows="3"
                        style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Add Owner</button>
            </form>
        </div>
    </div>

    <!-- Add Pet Modal -->
    <div id="petModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Pet</h3>
                <button class="close-modal" onclick="closeModal('petModal')">&times;</button>
            </div>
            <form id="addPetForm" onsubmit="submitAddPet(event)">
                <div class="input-group">
                    <label>Owner</label>
                    <select name="id_pemilik" id="pet-owner-select" required class="status-select"
                        style="width:100%; padding:0.8rem;">
                        <option value="">Select Owner</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Pet Name</label>
                    <input type="text" name="nama_hewan" required>
                </div>
                <div class="input-group">
                    <label>Species</label>
                    <select name="jenis_hewan" required class="status-select" style="width:100%; padding:0.8rem;">
                        <option value="Kucing">Kucing</option>
                        <option value="Anjing">Anjing</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Breed</label>
                    <input type="text" name="ras" placeholder="e.g. Persian, Golden Retriever">
                </div>
                <div class="input-group">
                    <label>Gender</label>
                    <select name="gender" required class="status-select" style="width:100%; padding:0.8rem;">
                        <option value="Jantan">Jantan</option>
                        <option value="Betina">Betina</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Date of Birth</label>
                    <input type="date" name="tgl_lahir"
                        style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;">
                </div>
                <div class="input-group">
                    <label>Weight (kg)</label>
                    <input type="number" step="0.01" name="berat" placeholder="e.g. 5.5">
                </div>
                <button type="submit" class="cta-button" style="width:100%; margin-top:1rem;">Add Pet</button>
            </form>
        </div>
    </div>

    <!-- Owner Details Modal -->
    <div id="ownerDetailsModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="owner-details-title">Owner Details</h3>
                <button class="close-modal" onclick="closeModal('ownerDetailsModal')">&times;</button>
            </div>
            <div id="owner-details-content" style="padding:1.5rem;">
                <p style="text-align:center; color:#94a3b8">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Medical Record Modal (Doctor) -->
    <div id="medicalRecordModal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Create Medical Record</h3>
                <button class="close-modal" onclick="closeModal('medicalRecordModal')">&times;</button>
            </div>
            <div style="background:rgba(139, 92, 246, 0.1); padding:1rem; border-radius:8px; margin-bottom:1.5rem;">
                <p style="margin:0; color:var(--text-color);"><strong>Pet:</strong> <span id="mr-pet-name"></span></p>
                <p style="margin:0.5rem 0 0 0; color:var(--text-color);"><strong>Owner:</strong> <span
                        id="mr-owner-name"></span>
                </p>
            </div>
            <form id="medicalRecordForm" onsubmit="submitMedicalRecord(event)">
                <input type="hidden" id="mr-id-daftar">

                <div class="input-group">
                    <label>Diagnosis</label>
                    <textarea id="mr-diagnosa" rows="3" required
                        style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                </div>

                <div class="input-group">
                    <label>Treatment / Actions Taken</label>
                    <textarea id="mr-tindakan" rows="3" required
                        style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                </div>

                <div class="input-group">
                    <label>Doctor's Notes</label>
                    <textarea id="mr-catatan" rows="2"
                        style="width:100%; padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:white; border-radius:5px;"></textarea>
                </div>

                <!-- Prescription Section -->
                <div style="border-top:1px solid var(--glass-border); padding-top:1.5rem; margin-top:1.5rem;">
                    <h4 style="margin-bottom:1rem; color:var(--accent-color);">Prescriptions</h4>

                    <div style="display:grid; grid-template-columns: 2fr 1fr 2fr auto; gap:0.5rem; margin-bottom:1rem;">
                        <select id="medicine-select" class="status-select" style="padding:0.8rem;">
                            <option value="">Select Medicine</option>
                        </select>
                        <input type="number" id="medicine-qty" min="1" placeholder="Qty"
                            style="padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:var(--text-color); border-radius:5px;">
                        <input type="text" id="medicine-usage" placeholder="Usage instructions (e.g., 2x daily)"
                            style="padding:0.8rem; background:rgba(255,255,255,0.05); border:1px solid var(--glass-border); color:var(--text-color); border-radius:5px;">
                        <button type="button" onclick="addPrescription()" class="cta-button"
                            style="padding:0.8rem 1.5rem; white-space:nowrap;">
                            <i class="fa-solid fa-plus"></i> Add
                        </button>
                    </div>

                    <div id="prescription-list" style="margin-top:1rem;">
                        <!-- Prescriptions will be added here dynamically -->
                    </div>
                </div>

                <button type="submit" class="cta-button" style="width:100%; margin-top:1.5rem;">
                    <i class="fa-solid fa-save"></i> Save Medical Record
                </button>
            </form>
        </div>
    </div>

    <script>
        // Load medicines into select when modal opens
        document.addEventListener('DOMContentLoaded', async () => {
            const medRes = await fetch('/api/medicines');
            if (medRes.ok) {
                const medicines = await medRes.json();
                const select = document.getElementById('medicine-select');
                medicines.forEach(med => {
                    const opt = document.createElement('option');
                    opt.value = med.id_barang;
                    opt.textContent = `${med.nama_barang} (Stock: ${med.stok})`;
                    select.appendChild(opt);
                });
            }
        });
    </script>
    <script src="js/dashboard.js"></script>
</body>

</html>